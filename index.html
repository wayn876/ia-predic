<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego F1 en 3D</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
    </style>
</head>
<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/controls/PointerLockControls.js"></script>
    <script>
        // Configuración básica de Three.js
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer();

        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Establecer color de fondo
        renderer.setClearColor(0x87CEEB); // Color de cielo

        // Crear una fuente de luz
        const ambientLight = new THREE.AmbientLight(0x404040); // Luz ambiental suave
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 1); // Luz direccional
        directionalLight.position.set(5, 10, 5).normalize();
        scene.add(directionalLight);

        // Crear una pista colorida
        const trackGeometry = new THREE.PlaneGeometry(50, 50);
        const trackMaterial = new THREE.MeshBasicMaterial({
            map: new THREE.TextureLoader().load('https://www.w3schools.com/w3images/road.jpg'),
            side: THREE.DoubleSide
        });
        const track = new THREE.Mesh(trackGeometry, trackMaterial);
        track.rotation.x = -Math.PI / 2; // Alineación horizontal
        track.position.y = -0.1;
        scene.add(track);

        // Crear un cubo para representar el coche
        const carGeometry = new THREE.BoxGeometry(1, 0.5, 2);
        const carMaterial = new THREE.MeshLambertMaterial({ color: 0xff0000 });
        const car = new THREE.Mesh(carGeometry, carMaterial);
        car.position.y = 0.25;
        scene.add(car);

        // Crear un volante (representado como un cilindro)
        const wheelGeometry = new THREE.CylinderGeometry(0.3, 0.3, 0.1, 32);
        const wheelMaterial = new THREE.MeshLambertMaterial({ color: 0x0000ff });
        const wheel = new THREE.Mesh(wheelGeometry, wheelMaterial);
        wheel.rotation.z = Math.PI / 2;
        wheel.position.set(0, 0.8, 0);
        car.add(wheel);

        // Posicionar la cámara en el coche
        camera.position.set(0, 1, 2); // Dentro del coche

        // Agregar controles de primera persona
        const controls = new THREE.PointerLockControls(camera, renderer.domElement);

        document.addEventListener('click', () => {
            controls.lock();
        });

        // Configuración de sonido
        const listener = new THREE.AudioListener();
        camera.add(listener);

        const sound = new THREE.Audio(listener);
        const audioLoader = new THREE.AudioLoader();
        audioLoader.load('https://www.soundjay.com/button/beep-07.wav', (buffer) => {
            sound.setBuffer(buffer);
            sound.setLoop(true);
            sound.setVolume(0.5);
        });

        // Variables para controlar el movimiento del coche
        const speed = 0.1;
        const turnSpeed = 0.05;
        const keys = {};

        window.addEventListener('keydown', (event) => {
            keys[event.code] = true;
        });

        window.addEventListener('keyup', (event) => {
            keys[event.code] = false;
        });

        function moveCar() {
            let moving = false;
            if (keys['KeyW']) {
                car.position.z -= speed;
                moving = true;
            }
            if (keys['KeyS']) {
                car.position.z += speed;
                moving = true;
            }
            if (keys['KeyA']) {
                car.rotation.y += turnSpeed;
                wheel.rotation.y += turnSpeed; // Hacer girar el volante
            }
            if (keys['KeyD']) {
                car.rotation.y -= turnSpeed;
                wheel.rotation.y -= turnSpeed; // Hacer girar el volante
            }
            if (moving && !sound.isPlaying) {
                sound.play(); // Reproducir sonido si el coche está en movimiento
            } else if (!moving && sound.isPlaying) {
                sound.stop(); // Detener sonido si el coche no se mueve
            }
        }

        function animate() {
            requestAnimationFrame(animate);

            moveCar();

            // Actualizar el volante (simplemente para demostrar la rotación)
            wheel.rotation.z += 0.02;

            renderer.render(scene, camera);
        }

        animate();

        // Manejo de redimensionamiento de la ventana
        window.addEventListener('resize', () => {
            renderer.setSize(window.innerWidth, window.innerHeight);
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
        });
    </script>
</body>
</html>
